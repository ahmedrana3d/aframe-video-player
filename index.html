<head>
  <title>Panaroma Video Player | Demo</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <!-- <script src="https://unpkg.com/aframe-immersive-video-component/dist/aframe-immersive-video-component.min.js"></script> -->
  <script src="./aframe-html.min.js"></script>
  <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
  <script>


AFRAME.registerComponent('hover-effect', {
    init : function () {
        const el = this.el;
        el.addEventListener('mouseenter', function () {
            el.setAttribute('opacity', '0.5');
        });
        el.addEventListener('mouseleave', function () {
            el.setAttribute('opacity', '1');
        });
    }
})


    AFRAME.registerComponent("play-pause", {
      schema: {
        type: "selector",
      },
      init: function () {
        var video = this.data;
        const el = this.el;
        const popUp = document.querySelector("#pop-up");

        var messageLogged = false;

        // Add an event listener to the 'timeupdate' event
        video.addEventListener("timeupdate", function () {


          if (video.currentTime <= 10 && messageLogged) {
            messageLogged = false;
            popUp.setAttribute("visible", "false");
      popUp.setAttribute("scale", "0 0 0");
          }

          if (video.currentTime >= 10 && !messageLogged) {
            popUp.setAttribute("visible", "true");
            popUp.setAttribute("scale", "10 10 10");

            video.pause();
            el.setAttribute("src", "#play");

            messageLogged = true;
          }
        });







 
        const secondsDisplay = document.getElementById('vid-seconds');

// Add event listener to update range input and seconds display when video time is changed
video.addEventListener('timeupdate', function() {

  updateSecondsDisplay();
});

// Function to update the seconds display
function updateSecondsDisplay() {
  const currentTimeFormatted = formatTime(video.currentTime);
  const durationFormatted = formatTime(video.duration);
  secondsDisplay.textContent = `${currentTimeFormatted} / ${durationFormatted}`;
}

// Function to format time in seconds to MM:SS format
function formatTime(timeInSeconds) {
  const minutes = Math.floor(timeInSeconds / 60);
  const seconds = Math.floor(timeInSeconds % 60);
  const formattedMinutes = minutes < 10 ? `0${minutes}` : `${minutes}`;
  const formattedSeconds = seconds < 10 ? `0${seconds}` : `${seconds}`;
  return `${formattedMinutes}:${formattedSeconds}`;
}

        this.el.addEventListener("click", function () {
          if (video.paused) {
            video.play();
            el.setAttribute("src", "#pause");
            popUp.setAttribute("visible", "false");
      popUp.setAttribute("scale", "0 0 0");
          } else {
            video.pause();
            el.setAttribute("src", "#play");
          }
        });
      },
    });

    AFRAME.registerComponent("forward", {
      schema: {
        type: "selector",
      },
      init: function () {
        var video = this.data;
        const el = this.el;
        this.el.addEventListener("click", function () {
          video.currentTime += 5;
        });
      },
    });

    AFRAME.registerComponent("backward", {
      schema: {
        type: "selector",
      },
      init: function () {
        var video = this.data;
        const el = this.el;
        this.el.addEventListener("click", function () {
          video.currentTime -= 5;
        });
      },
    });
  </script>
</head>

<body>
  <a-scene
    raycaster="objects: .clickable; interval:100;"
    cursor="rayOrigin: mouse"
  >
    <a-assets>
      <video
        muted
        loop
        autoplay
        id="panaroma-video"
        src="./assets/videopanaroma.mp4"
      ></video>

      <!-- Video Controls Icons  -->

      <img id="play" src="./assets/icons/play.png" alt="" />
      <img id="pause" src="./assets/icons/pause-button.png" alt="" />
      <img id="forward" src="./assets/icons/forward-5.png" alt="" />
      <img id="backward" src="./assets/icons/backward-5.png" alt="" />
    </a-assets>

    <a-sphere
      color="black"
      radius="0.1"
      id="cursor"
      material="shader:flat"
      visible="false"
    ></a-sphere>
    <a-entity
      id="pop-up"
      class="clickable"
      scale="0 0 0"
      visible="false"
      html="html:#my-interface;cursor:#cursor;"
      position="0 1.5 -5.913"
    ></a-entity>


    <!-- Range Controls  -->




    <!-- Video Controls  -->

    <a-entity scale="0.3 0.3 0.3" look-at="[camera]" position="-0.99 -1.6846 -2.19015" rotation="-31.363 13.816 0" geometry="depth: 0; height: 1.17; width: 6.81" material="color: #383838" scale="0.4 0.4 0.4">
      <a-image hover-effect="" class="clickable" src="#play" play-pause="#panaroma-video" position="0.13944 -0.003 0.01012" material="" geometry="" opacity="1"></a-image>
      <a-image hover-effect="" class="clickable" forward="#panaroma-video" src="#forward" position="2.52779 -0.01045 0.03527" material="" geometry="" opacity="1"></a-image>
      <a-image hover-effect="" class="clickable" backward="#panaroma-video" src="#backward" position="-2.41451 0.02823 0.15399" material="" geometry="" opacity="1"></a-image>



      <a-entity class="clickable" scale="50 50 10" html="html: #range-interface; cursor: #cursor" position="0.02519 -0.79215 -0.05929" rotation="0 0 -1.06"></a-entity>

    </a-entity>



<!-- camera  -->

<a-entity
id="rig"


>
<a-entity
  id="player"
  camera="near: 0.099;"
  position="0 1.6 0"
  look-controls

>

</a-entity>
<a-entity laser-controls="hand : left;" raycaster="objects: .clickable; far: 25"></a-entity>
<a-entity laser-controls="hand : right;" raycaster="objects: .clickable; far: 25"></a-entity>
</a-entity>




    <a-sky rotation="0 -90 0" src="#panaroma-video"></a-sky>
  </a-scene>

  <section
    style="
      display: flex;
      width: 500px;
      height: 300px;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background: #2a2a2e;
      text-align: center;
      color: #d6d6d6;
      border-radius: 1em;
      padding: 1em;
      margin: 0;
      accent-color: hotpink;
    "
    id="my-interface"
  >
    <h2>Do You Know What</h2>
    <p>I dont know what to write here</p>
    <p>Will not do Lorem Ispum as it is not meaningfull</p>
    <p>This video player demo is for Arturo for POC</p>




    <div
      onclick="HandleClick()"
      style="
        display: block;
        padding: 10px 15px;
        border: #d6d6d6 solid;
        border-radius: 6px;
      "
    >
      Learn More
    </div>
  </section>





<section
style="

display: flex;
width: 200px;
height: 60px;
justify-content: flex-end;
align-items: center;

flex-direction: column;
background: #262626;
text-align: center;

border-radius: 1em;

margin: 0;
accent-color: hotpink;
"
id="range-interface">

  <div id="vid-seconds" style="color: #d6d6d6;">00:00/00:20</div>
</section>





  <script>
    const el = document.querySelector("#pop-up");
    const video = document.querySelector("#panaroma-video");

    HandleClick = () => {
      el.setAttribute("visible", "false");
      el.setAttribute("scale", "0 0 0");
    };
  </script>
</body>
